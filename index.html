<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
  font-family:Arial;
}
canvas{display:block;}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");

let w,h;
function resize(){
  w=canvas.width=innerWidth;
  h=canvas.height=innerHeight;
}
addEventListener("resize",resize);
resize();

const COUNT=4000;
const warpTime=4500;
const correct=["1","3","1","2"];

let start=null;
let formed=false;
let success=false;
let explode=false;
let input=[];
let heartPulse=0;

/* ---------- HEART ---------- */

function heartCurve(t){
  const x=16*Math.pow(Math.sin(t),3);
  const y=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
  return {x,y};
}

/* ---------- PARTICLES ---------- */

class Particle{
  constructor(i){
    this.i=i;
    this.reset();
  }

  reset(){
    this.x=(Math.random()-0.5)*w;
    this.y=(Math.random()-0.5)*h;
    this.z=Math.random()*w;
    this.alpha=1;
    this.vx=0;
    this.vy=0;
    this.finalX=0;
    this.finalY=0;

    // viel stärkere Streuung
    this.spread=(Math.random()-0.5)*80;
    this.innerSpread=Math.random()*30;
  }

  startExplosion(){
    const angle=Math.random()*Math.PI*2;
    const speed=2+Math.random()*2;
    this.vx=Math.cos(angle)*speed;
    this.vy=Math.sin(angle)*speed;
  }

  pos(progress){

    if(explode){
      this.finalX+=this.vx;
      this.finalY+=this.vy;

      this.vx*=1.005;
      this.vy*=1.005;
      this.alpha*=0.999;

      return {x:this.finalX,y:this.finalY};
    }

    const k=128/this.z;
    const sx=this.x*k+w/2;
    const sy=this.y*k+h/2;

    const scale=Math.min(w,h)/38*(1+heartPulse);

    const tVal=this.i/COUNT*Math.PI*2;
    const hp=heartCurve(tVal);

    const angle=Math.atan2(hp.y,hp.x);

    // radiale + zufällige Verteilung
    const hx=w/2
      +(hp.x*scale)
      +(Math.cos(angle)*this.spread)
      +(Math.random()-0.5)*this.innerSpread;

    const hy=h/2
      +(hp.y*scale)
      +(Math.sin(angle)*this.spread)
      +(Math.random()-0.5)*this.innerSpread;

    if(progress>=1){
      this.finalX=hx;
      this.finalY=hy;
    }

    return {
      x:sx*(1-progress)+hx*progress,
      y:sy*(1-progress)+hy*progress
    };
  }
}

let particles=[];
for(let i=0;i<COUNT;i++){
  particles.push(new Particle(i));
}

/* ---------- NUMBERS ---------- */

let numbers=[];
let scaleBase;

function generateNumbers(){
  numbers=[];
  scaleBase=Math.min(w,h)/38;
  const minDist=55;

  let required=["1","3","1","2"];

  while(required.length<12){
    required.push(Math.floor(Math.random()*10).toString());
  }

  for(let i=required.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [required[i],required[j]]=[required[j],required[i]];
  }

  for(let val of required){

    let px,py,valid=false;

    while(!valid){
      const t=Math.random()*Math.PI*2;
      const r=Math.sqrt(Math.random());
      const base=heartCurve(t);

      px=w/2+base.x*scaleBase*r*0.7;
      py=h/2+base.y*scaleBase*r*0.7;

      valid=true;
      for(let n of numbers){
        if(Math.hypot(px-n.x,py-n.y)<minDist){
          valid=false;
          break;
        }
      }
    }

    numbers.push({
      value:val,
      x:px,
      y:py,
      glow:0,
      sparkle:Math.random()*1000
    });
  }
}

/* ---------- CLICK ---------- */

canvas.addEventListener("click",e=>{
  if(!formed || success) return;

  const rect=canvas.getBoundingClientRect();
  const mx=e.clientX-rect.left;
  const my=e.clientY-rect.top;

  for(let n of numbers){
    if(Math.hypot(mx-n.x,my-n.y)<32){

      const expected=correct[input.length];

      if(n.value===expected){
        input.push(n.value);
        n.glow=1;
        heartPulse=0.15;

        if(input.length===correct.length){
          success=true;
          explode=true;
          particles.forEach(p=>p.startExplosion());
        }

      }else{
        input=[];
        heartPulse=-0.1;
      }

      break;
    }
  }
});

/* ---------- DRAW ---------- */

function draw(t){

  if(!start) start=t;

  let raw=Math.min((t-start)/warpTime,1);
  const progress=1-Math.pow(1-raw,3);

  if(progress>=1 && !formed){
    formed=true;
    generateNumbers();
  }

  ctx.fillStyle="rgba(0,0,0,0.2)";
  ctx.fillRect(0,0,w,h);

  heartPulse*=0.9;

  for(let p of particles){
    const pos=p.pos(progress);
    if(p.alpha<=0) continue;

    ctx.beginPath();
    ctx.arc(pos.x,pos.y,1.4,0,Math.PI*2);
    ctx.fillStyle="rgba(255,80,150,"+p.alpha+")";
    ctx.fill();
  }

  if(formed && !explode){

    ctx.font="bold 32px Georgia";
    ctx.textAlign="center";
    ctx.textBaseline="middle";

    for(let n of numbers){
      n.glow*=0.92;
      const sparkle=Math.sin(t*0.003+n.sparkle)*0.5+0.5;

      ctx.shadowBlur=25*n.glow+8*sparkle;
      ctx.shadowColor="white";
      ctx.fillStyle="rgba(255,255,255,"+(0.85+0.15*sparkle)+")";
      ctx.fillText(n.value,n.x,n.y);
      ctx.shadowBlur=0;
    }

    ctx.fillStyle="rgba(255,255,255,0.9)";
    ctx.font="22px Arial";
    ctx.fillText("Was ist unser Datum?",w/2,h-60);
    ctx.font="26px Arial";
    ctx.fillText(input.join(" "),w/2,h-30);
  }

  requestAnimationFrame(draw);
}

requestAnimationFrame(draw);
</script>
</body>
</html>